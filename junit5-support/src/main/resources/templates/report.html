<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/preflight.css">
    <link rel="stylesheet" href="assets/styles.css">
    <title>[[${pageTitle}]]</title>
</head>

<body>
    <header>
        <div id="branding">
            <img src="assets/specmatic-logo.svg" alt="Specmatic Logo" />
            <h1 th:text="${reportHeading}"></h1>
            <button id="print">
                <img src="assets/download.svg" alt="Print Button" />
            </button>
        </div>
        <div id="summary" th:class="'bg-' + ${summaryResult}" data-panel="table">
            <div id="coverage">
                <span>API Coverage</span>
                <span th:class="${summaryResult}">[[${totalCoverage}]]%</span>
            </div>
            <ol id="test-counts" data-filter="All">
                <li id="Success">
                    <img src="assets/check-badge.svg" alt="success-count" />
                    <span>Success: </span>
                    <span>[[${totalSuccess}]]</span>
                </li>
                <li id="Failed">
                    <img src="assets/x-circle.svg" alt="failed-count" />
                    <span>Failed: </span>
                    <span>[[${totalFailures}]]</span>
                </li>
                <li id="Error">
                    <img src="assets/exclamation-triangle.svg" alt="success-count" />
                    <span>Errors: </span>
                    <span>[[${totalErrors}]]</span>
                </li>
                <li id="Skipped">
                    <img src="assets/blocked.svg" alt="success-count" />
                    <span>Skipped: </span>
                    <span>[[${totalSkipped}]]</span>
                </li>
                <li class="active" id="All">
                    <img src="assets/clipboard.svg" alt="success-count" />
                    <span>Total: </span>
                    <span>[[${totalTests}]]</span>
                </li>
            </ol>
            <div id="badge">
                <img src="assets/badge.svg" alt="Result Badge" th:class="${summaryResult}" />
                <img th:src="'assets/mark-' + ${summaryResult} + '.svg'" alt="Result Mark" id="mark" />
            </div>
        </div>
    </header>

    <section id="additional-info" data-expand="false">
        <div id="header">
            <p th:if="${successCriteriaPassed == false}">
                Success Criteria Failed: <span class="rejected">Minimum API Coverage of [[${thresholdInfo.minThresholdPercentage}]]% was not met.</span>
            </p>
            <div id="dropdown">
                <p>Additional Info</p>
                <img src="assets/chevron-double-down.svg" alt="expand" />
            </div>
        </div>
        <ol id="info-grid">
            <li id="SUT" class="info">
                <p>System Under Test</p>
                <ul>
                    <li>
                        <span>Host</span>
                        <abbr th:attr="title=${sutInfo.host}" th:text="${sutInfo.host}"></abbr>
                    </li>
                    <li>
                        <span>Port</span>
                        <abbr th:attr="title=${sutInfo.port}" th:text="${sutInfo.port}"></abbr>
                    </li>
                    <li>
                        <span>Actuator</span>
                        <span th:text="${sutInfo.actuatorEnabled ? 'Enabled' : 'Disabled'}"></span>
                    </li>
                    <li>
                        <span>Total [[${sutInfo.mainGroupName}]]s</span>
                        <span th:text="${sutInfo.mainGroupCount}"></span>
                    </li>
                </ul>
            </li>
            <li id="REPORT" class="info">
                <p>Report</p>
                <ul>
                    <li>
                        <span>Generated On</span>
                        <span th:text="${generatedOn}"></span>
                    </li>
                    <li>
                        <span>Total Time</span>
                        <span th:text="${totalDuration}"></span>
                    </li>
                    <li>
                        <span>Specmatic Implementation</span>
                        <span th:text="${specmaticImplementation}"></span>
                    </li>
                    <li>
                        <span>Specmatic Version</span>
                        <span th:text="${specmaticVersion}"></span>
                    </li>
                </ul>
            </li>
            <li id="THRESHOLDS" class="info">
                <p>Threshold</p>
                <ul>
                    <li>
                        <span>Min Coverage Percentage</span>
                        <span>[[${thresholdInfo.minThresholdPercentage}]]%</span>
                    </li>
                    <li>
                        <span>Max Missed Endpoints</span>
                        <span th:text="${thresholdInfo.maxMissedEndpointsInSpec}"></span>
                    </li>
                    <li>
                        <span>Excluded Endpoints</span>
                        <span th:text="${#lists.size(excludedEndpoints)}"></span>
                    </li>
                    <li>
                        <span>Enforcing</span>
                        <span th:text="${thresholdInfo.enforce ? 'Yes' : 'No'}"></span>
                    </li>
                </ul>
            </li>
            <li id="SOURCES" class="info">
                <p>Contract Sources</p>
                <ol class="info">
                    <li class="info sub-info" th:each="contractSource : ${contractSources}">
                        <p>Source</p>
                        <ul class="provider">
                            <li>
                                <span>Provider</span>
                                <span th:text="${contractSource.provider}"></span>
                            </li>
                            <li>
                                <span>URI</span>
                                <span th:text="${contractSource.getUri()}"></span>
                            </li>
                            <li th:if="${contractSource.provider.toString() == 'git'}">
                                <span>Branch</span>
                                <span th:text="${contractSource.getBranchAndCommit().first}"></span>
                            </li>
                            <li>
                                <span>Commit</span>
                                <span th:text="${contractSource.getBranchAndCommit().second}"></span>
                            </li>
                        </ul>
                        <ol>
                            <li class="info sub-info">
                                <p>Provides</p>
                                <ul class="provides">
                                    <li th:each="specFile : ${contractSource.test}">
                                        [[${specFile}]]
                                    </li>
                                </ul>
                            </li>
                            <li class="info sub-info" th:if="${contractSource.stub}">
                                <p>Consumes</p>
                                <ul class="consumes">
                                    <li th:each="specFile : ${contractSource.stub}">
                                        [[${specFile}]]
                                    </li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ol>
                <ol th:if="${#lists.size(exampleDirs) > 0}">
                    <li class="info sub-info">
                        <p>Example Directories</p>
                        <ul>
                            <Li th:each="exampleDirectory : ${exampleDirs}">
                                [[${exampleDirectory}]]
                            </Li>
                        </ul>
                    </li>
                </ol>
            </li>
            <lI id="CONFIG" class="info">
                <p>Test Configuration</p>
                <ul>
                    <li>
                        <span>Resiliency Testing</span>
                        <span th:text="${testConfig.resiliencyTests.enable}"></span>
                    </li>
                    <li>
                        <span>Validate Response Values</span>
                        <span th:text="${testConfig.validateResponseValues ? 'Enabled' : 'Disabled'}"></span>
                    </li>
                    <li>
                        <span>Allow Extensible Schema</span>
                        <span th:text="${testConfig.allowExtensibleSchema ? 'Enabled' : 'Disabled'}"></span>
                    </li>
                    <li>
                        <span>Test Timeout</span>
                        <span>[[${testConfig.timeoutInMilliseconds}]]ms</span>
                    </li>
                </ul>
            </li>
        </ol>
    </section>

    <main class="group" data-panel="table">
        <table id="reports" data-filter="All">
            <thead>
                <tr>
                    <td>Coverage</td>
                    <td th:each="column: ${tableColumns}" th:attr="colspan=${column.colSpan}" th:text="${column.name}"></td>
                    <td>Exercised</td>
                    <td>Result</td>
                </tr>
            </thead>
            <tbody>
                <tr th:each="row : ${tableRows}" th:attr="data-type=${row.htmlResult}, data-color=${row.badgeColor}">
                    <td th:text="${row.coveragePercentage} + '%'" th:classappend="${row.groups[0].showRow} ? '' : 'hidden'"
                        th:attr="rowspan=${row.groups[0].rowSpan}, data-main=${row.groups[0].showRow}"></td>
                    <td th:each="group,iter: ${row.groups}" th:classappend="${group.showRow} ? '' : 'hidden'"
                        th:attr="rowspan=${group.rowSpan}, colspan=${tableColumns[iter.index].colSpan}, data-main=${group.showRow}, data-colName=${group.columnName}"
                        th:text="${group.value}">
                    </td>
                    <td th:text="${row.exercised}"></td>
                    <td><span class="pill" th:classappend="${row.badgeColor}" th:text="${row.result}"></span></td>
                </tr>
            </tbody>
        </table>
        <div id="details">
            <div id="group-details">
                <button id="back" tabindex="-1">
                    <span>&larr;</span>
                    <span>Go Back</span>
                </button>
                <ul id="group-summary">
                </ul>
                <div id="sort" data-expand="false" data-sort="scenario type" data-order="asc">
                    <img src="assets/sort.svg" alt="Sort Button" />
                    <p>Scenario Type</p>
                    <img src="assets/chevron-down.svg" alt="expand" />
                    <ol id="sort-select">
                        <li data-sort="result" >
                            <span>Result</span>
                        </li>
                        <li data-sort="scenario type">
                            <span>Scenario Type</span>
                        </li>
                        <li data-sort="duration">
                            <span>Duration</span>
                        </li>
                    </ol>
                </div>
            </div>
            <ol id="scenarios">
            </ol>
        </div>
    </main>
    <script id="json-data"  type="application/json">
        [(${jsonTestData})]
    </script>
    <script defer src="assets/utils.js" type="text/javascript"></script>
    <script defer src="assets/index.js" type="text/javascript"></script>
    <script defer src="assets/tableFilter.js" type="text/javascript"></script>
    <script defer src="assets/summaryUpdater.js" type="text/javascript"></script>
</body>

</html>
