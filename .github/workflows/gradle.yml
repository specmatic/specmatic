name: Java Build with Gradle

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    strategy:
      matrix:
        os: [ ubuntu-latest, windows-latest ]
    runs-on: ${{ matrix.os }}
    permissions:
      contents: write # This is required so that the dependency check can push dependency graph to the github repository
    steps:
      - uses: znsio/specmatic-github-workflows/action-build-gradle@main
        with:
          gradle-extra-args: -Pgithub.actor=${{ secrets.SPECMATIC_GITHUB_USER }} -Pgithub.token=${{ secrets.SPECMATIC_GITHUB_TOKEN }}

      - name: Fail if slf4j is found in the log
        if: matrix.os == 'ubuntu-latest'
        run: |
          java -jar application/build/libs/application-*-all-unobfuscated.jar --version 2>&1 | grep -i slf4j
          
          if [ $? -eq 0 ]
          then
            exit 1
          fi
